# MySQL数据库与JDBC编程

通过使用JDBC，Java程序可以非常方便地操作各种主流数据库。由于Java语言的跨平台特性，所以使用JDBC编写的程序不仅可以实现跨数据库，还可以跨平台，具有非常优秀的可移植性。

程序使用JDBC API以统一的方式来连接不同的数据库，然后通过Statement对象来执行标准的SQL语句，并可以获得SQL语句访问数据库的结果。

## JDBC基础

JDBC的全称是Java Database Connectivity，即Java数据库连接，它是一种可以执行SQL语句的Java API。程序可以通过JDBC API连接到关系数据库，并使用结构化查询语言（SQL，数据库标准的查询语言）来完成对数据库的查询、更新。

### JDBC简介

通过使用JDBC，就可以使用同一种API访问不同的数据库系统。开发人员面向JDBC API编写应用程序，然后根据不同的数据库，使用不同的数据库驱动程序即可。

程序云使用JDBC时只要面向标准的JDBC API编程即可，当需要在数据库之间切换时，只要更换不同的实现类（即更换数据库驱动程序）就行，这是面向编程的典型应用。

Java语言的各种跨平台特性，都采用相似的结构，因为它们都需要让相同的程序在不同的平台上运行，所以都需要中间的转换程序（为了实现Java程序的跨平台性，Java为不同的操作系统提供了不同的虚拟机）。同样，为了使JDBC程序可以跨平台，则需要不同的数据库厂商提供相应的驱动程序。

### JDBC驱动程序

数据库驱动程序是JDBC程序和数据库之间的转换层，数据库驱动程序负责将JDBC调用映射成特定的数据库调用。

> 还有一种名为ODBC的技术，其全称是Open Database Connectivity，即开放数据库连接。ODBC和JDBC很像，严格来说，应该是JDBC模仿了ODBC的设计。ODBC也允许应用程序通过一组通用的API访问不同的数据库管理系统，从而使得基于ODBC的应用程序可以在不同的数据库之间切换。同样，ODBC也需要各种数据库厂商提供相应的驱动程序，而ODBC则负责管理这些驱动。

JDBC驱动通常有如下4中类型。

- 第1种JDBC驱动：称为JDBC-ODBC桥，这种驱动是最早实现的JDBC驱动程序，主要目的是为了快速推广JDBC。这种驱动将JDBC API映射到ODBC API。这种方式在Java8中已经被删除了。
- 第2种JDBC驱动：直接将JDBC API映射成数据库特定的客户端API。这种驱动包含特定数据库的本地代码，用于访问特定数据库的客户端。
- 第3中JDBC驱动：支持三层协议的JDBC访问方式，主要用于Applet阶段，通过Applet访问数据库。
- 第4中JDBC驱动：是纯Java的，直接与数据库实例交互。这种驱动是智能的，它知道数据库使用的底层协议。这种驱动是目前最流行的JDBC驱动。

> 早期为了让Java程序操作Access这种伪数据库，可能需要使用JDBC-ODBC桥，但JDBC-ODBC桥不适合在并发访问数据库的情况下使用，其固有的性能和扩展能力也非常有限，因此Java8删除了JDBC-ODBC桥驱动。

通常建议选择第4种驱动，这种驱动避开了本地代码，减少了应用开发的复杂性，也减少了产生冲突和出错的可能。如果对性能有严格的要求，则可以考虑使用第2种驱动，但使用这种驱动，则势必增加编码和维护的困难。

相对于ODBC而言，JDBC更加简单。总结起来，JDBC比ODBC多了如下几个优势。

- ODBC更复杂，ODBC中有几个命令需要配置很多复杂的选项，而JDBC则采用简单、直观的方式来管理数据库连接。
- JDBC比ODBC安全性更高，更易部署。

## SQL语法

SQL语句是对所有关系数据库都通用的命令语句，而JDBC API只是执行SQL语句的工具，JDBC允许对不同的平台、不同的数据库采用相同的编程接口来执行SQL语句。

> 除标准的SQL语句之外，所有的数据库都会在标准SQL语句基础上进行扩展，增加一些额外的功能，这些额外的功能属于特定的数据库系统，不能在所有的数据库系统上都通用。因此，如果想让数据库应用称俄叙可以跨数据库运行，则应该尽量少用这些属于特定数据库的扩展。

### 关系数据库基本概念和MySQL基本命令

数据库（Database）仅仅是存放用户数据的地方。当用户访问、操作数据库中的数据时，就需要数据库管理系统的帮助。数据库管理系统的全称是Database Management System，简称DBMS。

DBMS是所有数据的知识库，它负责数据库的存储、安全、一致性、并发、恢复和访问等操作。DBMS有一个数据字典（有时也被称为系统表），用于存储它拥有的每个事务的相关信息，例如名字、结构、位置和类型，这种关于数据的数据也被称为元数据（metadata）。

在数据库发展历史中，按时间顺序主要出现了如下几种类型的数据库系统。

- 网状型数据库
- 层次型数据库
- 关系数据库
- 面向对象数据库

对于关系数据库而言，最基本的数据存储单元就是数据表，因此可以简单地把数据库想象成大量数据表的集合。

数据表是存储数据的逻辑单元，可以把数据表想象成由行和列组成的表格，其中每一行也称为一条记录，每一列也被称为一个字段。

MySQL数据库的一个实例（Server Instance）可以同时包含多个数据库，MySQL使用如下命令来查看当前实例下包含多少个数据库：

```mysql
show databases;
```

如果用户需要创建新的数据库，则可以使用如下命令：

```mysql
create database [IF NOT EXISTS] 数据库名;
```

如果用户需要删除指定数据库，则可以使用如下命令：

```mysql
drop database 数据库名;
```

建立了数据库之后，如果想操作该数据库，则需要进入该数据库。进入指定数据库可以使用如下命令：

```mysql
use 数据库名;
```

进入数据库后，如果需要查询该数据库下包含多少个数据表，则可以使用如下命令：

```mysql
show tables;
```

如果想查看指定数据表的表结构，则可以使用如下命令：

```mysql
desc 表名;
```

MySQL数据通常支持如下两种存储机制。

- MyISAM：这是MySQL早期默认的存储机制，对事务支持不够好。
- InnoDB：InnoDB提供事务安全的存储机制。InnoDB通过建立行级锁来保证事务完整性，并以Oracle风格的共享锁来处理Select语句。系统默认启动InnoDB存储机制，如果不想使用InnoDB表，则可以使用skip-innodb选项。

对比两种存储机制，不难发线InnoDB比MyISAM多了事务支持的功能，而事务支持是Java EE最重要的特性，因此通常推荐使用InnoDB存储机制。如果使用5.0以上版本的MySQL数据库系统，通常无须指定数据表的存储机制，因为系统默认使用InnoDB存储机制。如果需要在建表时显式指定存储机制，则可在标准建表语法的后面添加下面任意一句。

- `ENGINE=MyISAM`——强制使用MyISAM存储机制。
- `ENGINE=InnoDB`——强制使用InnoDB存储机制。

